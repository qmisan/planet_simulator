%------------------------------------------------------------------------------
%----------LaTex-pohja S--72.1110 Signaalit ja järjestelmät kurssille----------
%-----------------------Laatinut Atte Yrjölä 17.10.2013------------------------
%------------------------------------------------------------------------------

\documentclass[a4paper, 12pt, finnish]{report} %dokumenttiluokka ja sille muutamia määrityksiä
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[finnish]{babel} %suomenkieli
\usepackage{amsmath} %matematiikka kirjasto
\usepackage{graphicx} %kuvien liittämiseen kuten etusivun Aalto-logo
\usepackage{hyperref}
%\usepackage{pgfplots} %kuvaajien piirtämiseen, ota kommentointi pois mikäli haluat käyttää


\pagestyle{empty} %ei numeroita sivulle, mikäli niitä silti ilmestyy niin käytä komentoa \thispagestyle{empty} näillä sivuilla. Ei meinaa jostain syystä toimia report luokan kanssa
\setlength{\parindent}{0mm} %ei sisennystä uusiin kappaleisiin
\setlength{\emergencystretch}{15pt} %tekstin muokkaamiseen eli sallii välien venytyksen riveillä jotta näyttää paremmalta
\newcommand*{\findate}{\the\day.\the\month.\the\year} %uusi komento päivämäärän esittämiseen suomalaisittain
\newcommand*{\sijoitus}[2]{\mathop{\Big/}\limits_{\mspace{-19mu}#1}^{\mspace{19mu}#2}} % uusi komento jolla saadaan itgeraaliin suomalainen sijoitus viiva, käytetään \sijoitus{yläraja}{alaraja}, vaatii amsmath kirjaston

%ohjeita LaTeXin käyttöön löytyy hyvin esimerkiksi sivulta http://www.uta.fi/sis/mtt/latex/index.html

\begin{document} %dokumentin aloitus

\begin{titlepage}
%Kansisivun muotoilu
	\begin{flushleft}
	\includegraphics[scale = 0.5]{aaltologo}
	\end{flushleft}
  \centering
  \vspace*{11\baselineskip}
  \large
  \bfseries
  CSE-A1121 Ohjelmoinnin peruskurssi Y2 \\
	[5\baselineskip]
  \normalfont
  \small
  Planeetta simulaattori \\ %vaihda tähän työn numero
	Projektidokumentti \\ %jälkiselostus/esiselostus
	\vspace*{8\baselineskip}


	\hspace*{180pt}
	\makebox[30pt][l]{Henri Merilä 356194} \\ %tekijä 1
	\hspace*{180pt}
	\makebox[30pt][l]{Sähkötekniikan koulutusohjelma} \\ %tekijä 2
	\hspace*{180pt}
	\makebox[30pt][l]{3. vuosikurssi} \\ %tekijä 2
	\hspace*{180pt} 
	\makebox[30pt][l]{Assari: Petri Leskinen } \\ %tekijä 2
	[1\baselineskip]
	\hspace*{180pt}
	 \\ %assistentti
	[1\baselineskip]
	\hspace*{180pt}
	\makebox[30pt][l]{Dokumentti laadittu: 15.5.2015} \\ %selostuksen laatimis päivä

\end{titlepage}

%\tableofcontents %ota kommentointi pois mikäli haluat että LaTeX muodostaa automaattisen sisällysluettelon

%itse dokumentti osio alkaa tästä
%alla muutamia vaiheita miten dokumenttia voi alkaa rakentamaan
%matemaattisen kaavojen kirjoittamisesta saa lisää opastusta internetistä

\section*{Yleistä}
		Loin projektityönäni planeetta-simulaattorin. Simulaattorilla pystyy lukemaan tekstitiedostosta planeettojen sijainnit simulointiavaruudessa, massat,  nopeudet ja värin. Simulaationtilanteen lukemisen jälkeen 
simulaattorilla pystyy simuloimaan planeettojen liikettä avaruudessa kun aika kuluu eteenpäin. Ajan nopeutta pystyy säätämään, kuin myös laskennallista aikahyppyä ja piirtotaajuutta. Simulaattori piirtää 3D-mallinnuksen tilanteesta ja kykenee katsomaan tilannetta erilaisista näkökulmista. Tilanteen pystyy myös tallentamaan teksitiedostoon.\\
\linebreak{}		
\includegraphics[scale = 0.2]{simu1}		
\linebreak{}
Toteutus seuraa suurimmilta osin suunnitelmaa, mutta ominaisuuksia on jäänyt jonkin verran pois johtuen ajankäytöllisistä syistä. 3D-visualisointi kirjaston yhteensopivuusongelmat käyttöliittymäkirjastojen kanssa veivät suuren osan projektin toteutusajasta. Projekti on kokonaisuudessaan ollut minulle opettavainen ja vaativa.

\pagebreak
								
\section*{Käyttöohje}
\subsection*{Kirjasto ja käynnistys}
Ohjelma vaatii toimiakseen VPython moduulin ja Pythonista version 2.7. Molemmat näistä voi ladata suoraan osoitteesta  \url{ http://www.vpython.org/contents/download_windows.html}.
Kun nämä on asennettu voi ohjelman ajaa suoraan tuplaklikkaamalla `run.bat' tiedostoa ohjelman juurikansiossa. Klikkaamalla `test-run.bat' ohjelma käynnistyy \emph{debug}-tilaan käytyään yksikkötestit läpi. Debug-tilassa konsoliin tulostuu tietoa ohjelman ajosta.
 \linebreak{}		
\includegraphics[scale = 0.75]{simu2}

%\pagebreak		

\subsection*{Valikko}
Yläreunasta avautuvasta `File'-valikosta löytyy ohjelman kannalta keskeiset tiedostosta lataamis(\emph{Open}) ja tiedostoon kirjoittamis(\emph{Save as}) toiminnallisuudet. Lisäksi valikosta löytyy \emph{Exit} jolla voi poistua ohjelmasta. 
\linebreak{}		
\includegraphics[scale = 0.75]{simu3}
\linebreak{}
 Sekä `Open' että `Save as' valikkonäppäimiä käyttäessä avautuu tiedostodialogi-ikkuna, josta tiedostosijainnit on kätevä osoittaa.\\
\includegraphics[scale = 0.2]{simu5}
 \pagebreak

\subsection*{Työkalut}
Työkalupalkista löytyvät \emph{Run}  ja \emph{Pause} näppäimet. Kun simulaatiotilanne on ladattu, run näppäimellä simulaatio lähtee käyntiin, kun taas pause näppäin pysäyttää simulaation ajamisen. Pysäytetyn simulaatio-tilanteen voi tallentaa valikon save-näppäimellä\\		
\includegraphics[scale = 0.75]{simu4}

%Seuraava kuva on simu6

\subsection*{Visualisointi-paneeli}															
Visualisointi ikkuna on koko simulaation sydän. Sitä voi hallita hiirellä seuraavilla komennoilla.

\begin{itemize}
\item Hiiren oikea näppäin pohjaan painettuna - Ohjaa kamerakulmaa
\item Hiiren rulla näppäin pohjaan painettuna - Ohjaa lähennystä (Eteen taakse)
\end{itemize}
\includegraphics[scale = 0.3]{simu6}
\\																
Lisäksi visualisointi paneelin alla on labels-checkbox, jolla visualisoinnista voi halutessaan poistaa elementtien merkkilaatat.

\pagebreak

\subsection*{Näkymän ohjauspaneeli}
Näkymän ohjauspaneeli ilmestyy kun sopiva simulointitiedosto on ladattu. Siinä näkyy tiedot simulaation kaikista elementeistä. Paneelin tietyn elementin nappia painamalla kamera siirtyy seuraamaan kyseistä elementtiä.
\\
% Kuva
\includegraphics[scale = 0.3]{simu9}
\\
\includegraphics[scale=0.3]{simu12}
\pagebreak

\section*{Ohjelman rakenne}
Src kansion alta koostuva ohjelman lähdekoodi koostuu main- functiosta ja kahdesta eri moduulista - Simulation ja GUI.
\\
\includegraphics[scale = 0.5]{simu10}

\subsection*{Simulation}
Simulation-moduuli sisältää ohjelman simulointi-osuuden - avaruuden sen kappaleet ja niiden visualisointi. Simulointi sisältää myös fysiikka-laskuihin tarvittavat funktiot sekä simulaation parsimisen tiedostosta.
\\
\includegraphics[scale = 0.5]{simu7}

\subsection*{GUI}
GUI-moduuli sisältää ohjelman käyttöliittymään liittyvät osat. GUI-moduuli käyttää kutsuu simulaatiota.
\\
\includegraphics[scale = 0.5]{simu8}
\pagebreak


\section*{Algoritmit ja tietorakenteet}
Ohjelmassa käytetään muutamaa fysiikan kaavaa laskemaan kappaleiden välisiä voimia ja uusia sijainteja. Laskut ovat pääosin vektori muotoisia johtuen 3-ulotteisesta avaruudesta.\\

\begin{itemize}
\item[Gravitaatiolaki]
\[\bar{F}=G\frac{m_1m_2}{d^2}\]
\item[Kiihtyvyys]
\[\bar{F}=m\bar{a}\]
\end{itemize}
Fysiikan päivityksestä piirtämiseen mennään seuraavalla kierrolla:
\begin{verbatim}
Simulation run 
----> space calculate
---------> for each element calculate next
\end{verbatim}
Tämän jälkeen kaikki päivitetään uuteen sijaintiinsa:
\begin{verbatim}
(Simulation run) 
----> space update
---------> for each element update
\end{verbatim}
Ruutu päivitetään run-komennolle annetun \emph{frequency} parametrin avulla, käytännössä taajuudella tarkoitetaan kuinka monta kertaa sekunnissa ruudunpäivitys suoritetaan.
\begin{verbatim}
(simulation run)
---->If full second:
--------->render visuals
\end{verbatim} 
\pagebreak
\section*{Tiedostot}
Ohjelma pystyy parsimaan simulaatiotiedot tekstitiedostosta. Parsiminen tapahtuu oheisella koodilla.
%Load from file code
\begin{verbatim}
with open(file) as f:
    data = f.readlines()
    for line in data:
        if not line.startswith("#"):
            line_data = line.split()

            # If type planet
            if line_data[0].strip().lower() == "planet":
                label = line_data[1]
                vec = line_data[2].split(",")
                position = vector(float(vec[0]), float(vec[1]),
                                  float(vec[2]))
                vec = line_data[3].split(",")
                velocity = vector(float(vec[0]), float(vec[1]),
                                  float(vec[2]))
                mass = float(line_data[4])
                line_data[5].strip("\n")
                clr = Element.colors[line_data[5]]
                new_element = Planet(label, position, velocity,
                                     mass, clr)
                self.add(new_element)
\end{verbatim}
Tiedostoon kirjoitus on hieman yksinkertaisempi operaatio:
\begin{verbatim}
f = open(file, "w")
f.write("# This is simulation state file\n")
f.write("# Tyyppi label position(muodossa: x,y,z)"
        "velocity(x,y,z) mass color\n")
for element in self.space.element_list:
    f.write(element.type + " " +
            element.label + " " +
            str(element.position.x)+","+str(element.position.y)+","
            + str(element.position.y) + " " +
            str(element.velocity.x)+","+str(element.velocity.y)+","
            + str(element.velocity.y)+" "+str(element.mass) + " " +
            element.get_color() + "\n")
f.close()

\end{verbatim}
\section*{Testaus}
Testaus tiedostot sijaitsevat /src/ kansiossa. Ne voi ajaa painamalla test.bat tiedostoa. Yksikkötestit kattavat fysiikkamoottorin, simulaation ja elementit. Testausta varten tein ohjelmaan myös debug-moden, jossa ohjelma kirjoittaa ajonaikaisia kommentteja konsoliin. Tämän moden voi ajaa juuri kansion test-run.batista.

\includegraphics[scale=0.4]{simu11}
\pagebreak
\section*{Ohjelman tunnetut puutteet ja viat}
% Tähän myös 3 parasta ja heikointa kohtaa
Ohjelmassa on vielä paljon kehitettävää, mutta siinä on myös mielestäni erittäin hyviä puolia. 3D-visualisointi on suhteellisen näyttävä ja fysiikka on moduulimuotoisena myös kehitettävissä. Hyvää on myös parametrinä annettava simulointi nopeus ja timestep jotka mahdollistavat muuten hyvin hitaasti tapahtuvan simuloinnin nopeuttamisen. Erityisesti olen koodissa ylpeä näkymän hallinta paneelista joka dynaamisesti luo näppäimet ja funktiot kullekkin simulaation elementille.
Ohjelman kehitettävistä puolista mainitsen samaisen näkymän hallinta paneelista, sillä sen tila on rajallinen. Paneeli elementti tulisi muuttaa esim rullattavaksi, jotta siihen mahtuisi enemmän kappaleita. Lisäksi ohjelman staattinen ikkunakoko (ei skaalaudu pienentäessä) on miinus. Käytin paljon aikaa muutettavan koon toteuttamiseen, mutta käyttämäni kirjastot eivät pelanneet yhteen ja jouduin luopumaan ajatuksesta. 
\begin{itemize}
\item[Plussat]\begin{itemize}
\item[+] 3D-visualisointi kokonaisuudessaan
\item[+] Käyttöliittymän ominaisuudet
\item[+] Laajennettavuus
\end{itemize}
\item[Miinukset]\begin{itemize}
\item[-] Näkymän hallintapaneelin rajallinen koko
\item[-] Skaalaaminen
\item[-] Testejä voisi olla lisää
\end{itemize}
\end{itemize}

\section*{Aikataulu}
Sain projektin alkuun erittäin sujuvasti ja suurin osa suunnitellusta aikataulustani piti paikkansa, mutta tuli pari suurempaa vastoinkäymistä jotka veivät varsinkin toteutuksen keskivaiheilta paljon aikaani. Ehdottomasti suurin ongelma oli 3D-ikkunan upottaminen pääikkunaan. Grafiikkakirjastoni käytti pohjanaan wxPython kirjastoa, joten jouduin luopumaan kurssilla suositellusta PyQt kirjastosta alkuunsa. Halusin pitkään vielä tehdä ohjelmastani venytettävän, eli \emph{Sizereita} käyttämällä ohjelman eri paneelit reagoisivat automaattisesti koonmuutos tapahtumaan. Kaikki muu toimikin hyvin, mutta 3D-ikkuna ei vain suostunut näkymään sizerissa. Internetistä ei löytynyt aiheeseen juuri mitään apuja ja ainut vaihtoehto olisi ollut modata käyttämääni kirjastoa ja se olisi ollut turhan iso taakka tähän projektiin. Muuten pysyin suht hyvin aikataulussani, mutta jouduin jättämään ajanpuutteen vuoksi suunnittelemiani lisäominaisuuksia pois.
\section*{Yhteenveto}
Kokonaisuudessaan olen ohjelma-projektiini tyytyväinen. Kyseessä oli ensimmäinen laajempi itse suunnittelemani ja toteuttamani kokonaisuus. Suunnitteluni oli onnistunut ja se edesauttoi toteuttamista hyvin paljon. Lopputulos tekee perusasiansa hyvin, joten kokonaisuutena koen suorituksen itselleni erittäin hyväksi. Projektia tehdessä opin paljon luokkaperinnästä ja uutena tuttavuutena ohjelmoinnin aikana tuli \emph{lambda}-ilmaisu, joka on toinen tapa tehdä funktioita. Tällä toteutin dynaamisen näkymänhallinta paneelini. 
\section*{Viitteet}
\url{http://www.vpython.org/contents/docs/index.html}
\\
\url{http://www.stackoverflow.com}
\\
\url{zet}																																				
%dokumentti lopetetaan
\end{document}